<!DOCTYPE html>
<html>
<head>
  <title>Update Live Score</title>
  <meta charset="UTF-8">
  <style>
    body { background:#001f3f; font-family:Arial,sans-serif; color:#fff; padding:10px; }
    table { border-collapse:collapse; width:100%; margin-bottom:10px; }
    th, td { border:1px solid #444; padding:5px; text-align:center; }
    input, select { width:80px; padding:4px; text-align:center; }
    button { padding:6px 10px; margin:4px; border:none; border-radius:5px; cursor:pointer; background:#0074D9; color:#fff; font-weight:bold; }
    button:hover { background:#005fa3; }
    .swap-btn { background:#FF851B; }
    .next-btn { background:#2ECC40; }
    h3 { margin-top:20px; }
    .last6-display { display:flex; justify-content:center; gap:5px; margin-top:5px; }
    .last6-ball { width:28px; height:28px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:bold; }
    .ball-0 { background:#666; color:#fff; }
    .ball-1, .ball-2, .ball-3 { background:#00aa66; color:#fff; }
    .ball-4 { background:green; color:#fff; }
    .ball-6 { background:blue; color:#fff; }
    .ball-W { background:red; color:#fff; }
    .ball-extra { background:yellow; color:#000; }
  </style>
</head>
<body>
<h2>Update Live Score</h2>

<!-- Match Info -->
<table>
<tr>
  <th>Team A</th><th>Team B</th><th>Runs</th><th>Wickets</th><th>Overs</th>
  <th>Target</th><th>Target Overs</th><th>Target Wkts</th><th>Last 6 Balls</th>
</tr>
<tr>
  <td><input id="teamA"></td>
  <td><input id="teamB"></td>
  <td><input type="number" id="runs" readonly></td>
  <td><input type="number" id="wickets" readonly></td>
  <td><input id="overs" value="0.0" readonly></td>
  <td><input id="target"></td>
  <td><input id="targetOvers"></td>
  <td><input id="targetWickets"></td>
  <td>
    <div class="last6-display" id="last6Container"></div>
    <input type="hidden" id="last6">
  </td>
</tr>
</table>

<!-- Batsmen Info -->
<table>
<tr>
  <th colspan="6">Batsman 1</th>
  <th colspan="6">Batsman 2</th>
</tr>
<tr>
  <td>Name</td><td>R</td><td>B</td><td>4s</td><td>6s</td><td>SR</td>
  <td>Name</td><td>R</td><td>B</td><td>4s</td><td>6s</td><td>SR</td>
</tr>
<tr>
  <td><input id="b1Name"></td><td><input id="b1Runs" type="number" value="0" readonly></td><td><input id="b1Balls" type="number" value="0" readonly></td>
  <td><input id="b1Fours" type="number" value="0"></td><td><input id="b1Sixes" type="number" value="0"></td><td><input id="b1SR" readonly></td>
  <td><input id="b2Name"></td><td><input id="b2Runs" type="number" value="0" readonly></td><td><input id="b2Balls" type="number" value="0" readonly></td>
  <td><input id="b2Fours" type="number" value="0"></td><td><input id="b2Sixes" type="number" value="0"></td><td><input id="b2SR" readonly></td>
</tr>
</table>

<!-- Bowler -->
<table>
<tr><th>Name</th><th>Overs</th><th>Runs</th><th>Wkts</th><th>ECO</th></tr>
<tr>
  <td><input id="bowlerName"></td>
  <td><input id="bowlerOvers" value="0.0"></td>
  <td><input type="number" id="bowlerRuns" value="0"></td>
  <td><input type="number" id="bowlerWickets" value="0"></td>
  <td><input id="bowlerEco" readonly></td>
</tr>
</table>

<!-- Buttons -->
<button class="swap-btn" onclick="swapBatsmen()">Swap Batsmen</button>
<button class="next-btn" onclick="nextBatsman(1)">Next Batsman 1</button>
<button class="next-btn" onclick="nextBatsman(2)">Next Batsman 2</button>
<button onclick="saveData()">Save Score</button>

<h3>Quick Update - Last Ball</h3>
<select id="lastBall">
  <option value="">Select Ball</option>
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="6">6</option>
  <option value="W">Wicket</option>
  <option value="WD">Wide</option>
  <option value="NB">No Ball</option>
  <option value="LB1">Leg Bye 1</option>
  <option value="LB2">Leg Bye 2</option>
</select>
<button onclick="addLastBall()">Add Last Ball</button>

<p id="status"></p>

<script>
let legalBalls = 0; // only legal balls
let last6Balls = [];

function calcSR(r,b){ return b>0?((r/b)*100).toFixed(1):"0.0"; }
function calcECO(r,o){ let parts=o.split("."); let total=parseInt(parts[0])+(parseInt(parts[1]||0)/6); return total>0?(r/total).toFixed(2):"0.0"; }
function autoCalc(){
  b1SR.value=calcSR(+b1Runs.value,+b1Balls.value);
  b2SR.value=calcSR(+b2Runs.value,+b2Balls.value);
  bowlerEco.value=calcECO(+bowlerRuns.value,bowlerOvers.value);
}

function swapBatsmen(){
  const ids=["Name","Runs","Balls","Fours","Sixes","SR"];
  let temp={}; ids.forEach(f=>temp[f]=document.getElementById("b1"+f).value);
  ids.forEach(f=>document.getElementById("b1"+f).value=document.getElementById("b2"+f).value);
  ids.forEach(f=>document.getElementById("b2"+f).value=temp[f]);
}

function nextBatsman(num){
  document.getElementById(`b${num}Name`).value="";
  document.getElementById(`b${num}Runs`).value=0;
  document.getElementById(`b${num}Balls`).value=0;
  document.getElementById(`b${num}Fours`).value=0;
  document.getElementById(`b${num}Sixes`).value=0;
  document.getElementById(`b${num}SR`).value="0.0";
}

function incrementOvers(current){
  let [o,b]=current.split(".").map(x=>parseInt(x||0));
  b++; if(b>=6){ o++; b=0; } return `${o}.${b}`;
}

function updateLast6Display(){
  last6Container.innerHTML="";
  last6Balls.forEach(b=>{
    let span=document.createElement('div'); span.classList.add('last6-ball');
    if(b==='0') span.classList.add('ball-0');
    else if(['1','2','3'].includes(b)) span.classList.add('ball-1');
    else if(b==='4') span.classList.add('ball-4');
    else if(b==='6') span.classList.add('ball-6');
    else if(b==='W') span.classList.add('ball-W');
    else span.classList.add('ball-extra');
    span.innerText=b;
    last6Container.appendChild(span);
  });
}

function addLastBall(){
  let val=lastBall.value; if(!val)return;
  last6Balls.push(val); if(last6Balls.length>6) last6Balls.shift();
  last6.value=last6Balls.join(" ");
  updateLast6Display();

  let striker="b1", nonStriker="b2";
  if(val==="W"){
    wickets.value=+wickets.value+1;
    document.getElementById(striker+"Balls").value=+document.getElementById(striker+"Balls").value+1;
    nextBatsman(striker==="b1"?1:2);
  } else if(["0","1","2","3","4","6"].includes(val)){
    runs.value=+runs.value+ +val;
    document.getElementById(striker+"Runs").value=+document.getElementById(striker+"Runs").value+ +val;
    document.getElementById(striker+"Balls").value=+document.getElementById(striker+"Balls").value+1;
    if(val==="4") document.getElementById(striker+"Fours").value=+document.getElementById(striker+"Fours").value+1;
    if(val==="6") document.getElementById(striker+"Sixes").value=+document.getElementById(striker+"Sixes").value+1;
    if([1,3].includes(+val)) swapBatsmen();
  } else if(val==="WD"||val==="NB"){ runs.value=+runs.value+1; } 
  else if(val.startsWith("LB")){ runs.value=+runs.value+parseInt(val[2]); document.getElementById(striker+"Balls").value=+document.getElementById(striker+"Balls").value+1; if(parseInt(val[2])%2===1) swapBatsmen(); }

  if(!["WD","NB"].includes(val)) overs.value=incrementOvers(overs.value);
  autoCalc(); saveData();
}

async function saveData(){
  autoCalc();
  let payload={score:{
    teamA:teamA.value, teamB:teamB.value, runs:+runs.value, wickets:+wickets.value, overs:overs.value,
    target:target.value?+target.value:null, targetOvers:targetOvers.value||null, targetWickets:targetWickets.value||null,
    last6:last6.value,
    batsman1:{name:b1Name.value,runs:+b1Runs.value,balls:+b1Balls.value,fours:+b1Fours.value,sixes:+b1Sixes.value,sr:b1SR.value},
    batsman2:{name:b2Name.value,runs:+b2Runs.value,balls:+b2Balls.value,fours:+b2Fours.value,sixes:+b2Sixes.value,sr:b2SR.value},
    bowler:{name:bowlerName.value,overs:bowlerOvers.value,runs:+bowlerRuns.value,wickets:+bowlerWickets.value,eco:bowlerEco.value}
  }};
  try{
    let res=await fetch("update.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
    let result=await res.json();
    status.innerText=result.success?"✅ Score Updated!":"❌ Error!";
  }catch(e){ status.innerText="❌ Error!";}
}
</script>
</body>
</html>