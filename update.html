<!DOCTYPE html>
<html>
<head>
  <title>Update Live Score</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; padding: 15px; }
    h2, h3 { text-align: center; margin-bottom: 10px; }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 8px;
      margin-bottom: 10px;
    }
    input {
      width: 100%; font-size: 14px; padding: 6px;
      border-radius: 6px; border: 1px solid #444;
      background: #222; color: #fff;
      text-align: center;
    }
    .btn {
      width: 100%; padding: 10px; margin-top: 10px;
      font-size: 18px; border: none; border-radius: 8px;
      background: #28a745; color: #fff; cursor: pointer;
    }
    .btn:hover { background: #218838; }
    .ball-buttons {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px; margin-top: 10px;
    }
    .ball-btn {
      padding: 10px; font-size: 16px; border: none;
      border-radius: 6px; cursor: pointer; text-align: center;
    }
    .zero { background: #444; color: #fff; }
    .run { background: #00aa66; color: #fff; }
    .four { background: green; color: #fff; font-weight: bold; }
    .six { background: blue; color: #fff; font-weight: bold; }
    .wicket { background: red; color: #fff; font-weight: bold; }
    .extra { background: yellow; color: #000; font-weight: bold; }
  </style>
</head>
<body>
  <h2>üèè Update Live Score</h2>

  <div class="grid">
    <input id="teamA" type="text" placeholder="Team A" value="India">
    <input id="teamB" type="text" placeholder="Team B" value="Pakistan">
    <input id="runs" type="number" placeholder="Runs" value="0" oninput="updateCalculations()">
    <input id="wickets" type="number" placeholder="Wickets" value="0">
    <input id="overs" type="text" placeholder="Overs (e.g. 12.3)" value="0.0" oninput="updateCalculations()">
    <input id="target" type="number" placeholder="Target">
    <input id="last6" type="text" placeholder="Last 6 Balls" readonly>
  </div>

  <h3>Current Batsmen</h3>
  <div class="grid">
    <input id="batsman1Name" type="text" placeholder="B1 Name">
    <input id="batsman1R" type="number" placeholder="R" value="0" oninput="updateCalculations()">
    <input id="batsman1B" type="number" placeholder="B" value="0" oninput="updateCalculations()">
    <input id="batsman1F" type="number" placeholder="4s" value="0">
    <input id="batsman1S" type="number" placeholder="6s" value="0">
    <input id="batsman1SR" type="text" placeholder="SR" value="0.0" readonly>

    <input id="batsman2Name" type="text" placeholder="B2 Name">
    <input id="batsman2R" type="number" placeholder="R" value="0" oninput="updateCalculations()">
    <input id="batsman2B" type="number" placeholder="B" value="0" oninput="updateCalculations()">
    <input id="batsman2F" type="number" placeholder="4s" value="0">
    <input id="batsman2S" type="number" placeholder="6s" value="0">
    <input id="batsman2SR" type="text" placeholder="SR" value="0.0" readonly>
  </div>

  <h3>Bowler</h3>
  <div class="grid">
    <input id="bowlerName" type="text" placeholder="Bowler Name">
    <input id="bowlerO" type="text" placeholder="O" value="0.0" oninput="updateCalculations()">
    <input id="bowlerR" type="number" placeholder="R" value="0" oninput="updateCalculations()">
    <input id="bowlerW" type="number" placeholder="W" value="0">
    <input id="bowlerEco" type="text" placeholder="Eco" value="0.0" readonly>
  </div>

  <!-- Ball Buttons -->
  <div class="ball-buttons">
    <button class="ball-btn zero" onclick="addBall('0',0)">0</button>
    <button class="ball-btn run" onclick="addBall('1',1)">1</button>
    <button class="ball-btn run" onclick="addBall('2',2)">2</button>
    <button class="ball-btn run" onclick="addBall('3',3)">3</button>
    <button class="ball-btn four" onclick="addBall('4',4)">4</button>
    <button class="ball-btn six" onclick="addBall('6',6)">6</button>
    <button class="ball-btn wicket" onclick="addBall('W','wicket')">W</button>
    <button class="ball-btn extra" onclick="addBall('NB','nb')">NB</button>
    <button class="ball-btn extra" onclick="addBall('WD','wd')">WD</button>
  </div>

  <button class="btn" onclick="saveData()">üíæ Update Score</button>
  <p id="result"></p>

  <script>
    let last6Balls = [];

    function addBall(ball, type) {
      last6Balls.push(ball);
      if (last6Balls.length > 6) last6Balls.shift();
      document.getElementById("last6").value = last6Balls.join(" ");

      let runs = parseInt(document.getElementById("runs").value);
      let wickets = parseInt(document.getElementById("wickets").value);
      let overs = document.getElementById("overs").value;

      if (type === 'wicket') {
        wickets++;
      } else if (type === 'nb' || type === 'wd') {
        runs++;
      } else {
        runs += type;
        overs = incrementOvers(overs);
      }
      document.getElementById("runs").value = runs;
      document.getElementById("wickets").value = wickets;
      document.getElementById("overs").value = overs;
      updateCalculations();
    }

    function incrementOvers(overs) {
      let [o, b] = overs.split('.').map(n => parseInt(n) || 0);
      if (b < 5) b++; else { o++; b = 0; }
      return `${o}.${b}`;
    }

    function updateCalculations() {
      // Batsman 1 SR
      let r1 = parseInt(document.getElementById("batsman1R").value) || 0;
      let b1 = parseInt(document.getElementById("batsman1B").value) || 0;
      document.getElementById("batsman1SR").value = b1 > 0 ? ((r1 / b1) * 100).toFixed(2) : "0.0";

      // Batsman 2 SR
      let r2 = parseInt(document.getElementById("batsman2R").value) || 0;
      let b2 = parseInt(document.getElementById("batsman2B").value) || 0;
      document.getElementById("batsman2SR").value = b2 > 0 ? ((r2 / b2) * 100).toFixed(2) : "0.0";

      // Bowler ECO
      let bruns = parseInt(document.getElementById("bowlerR").value) || 0;
      let oversText = document.getElementById("bowlerO").value;
      let [o, b] = oversText.split('.').map(Number);
      let totalBalls = (o * 6) + (b || 0);
      let oversFloat = totalBalls / 6;
      document.getElementById("bowlerEco").value = oversFloat > 0 ? (bruns / oversFloat).toFixed(2) : "0.0";
    }

    async function saveData() {
      const payload = {
        score: {
          teamA: document.getElementById("teamA").value,
          teamB: document.getElementById("teamB").value,
          runs: parseInt(document.getElementById("runs").value),
          wickets: parseInt(document.getElementById("wickets").value),
          overs: document.getElementById("overs").value,
          last6: document.getElementById("last6").value,
          target: document.getElementById("target").value ? parseInt(document.getElementById("target").value) : null,
          batsman1: {
            name: document.getElementById("batsman1Name").value,
            runs: parseInt(document.getElementById("batsman1R").value),
            balls: parseInt(document.getElementById("batsman1B").value),
            fours: parseInt(document.getElementById("batsman1F").value),
            sixes: parseInt(document.getElementById("batsman1S").value),
            sr: document.getElementById("batsman1SR").value
          },
          batsman2: {
            name: document.getElementById("batsman2Name").value,
            runs: parseInt(document.getElementById("batsman2R").value),
            balls: parseInt(document.getElementById("batsman2B").value),
            fours: parseInt(document.getElementById("batsman2F").value),
            sixes: parseInt(document.getElementById("batsman2S").value),
            sr: document.getElementById("batsman2SR").value
          },
          bowler: {
            name: document.getElementById("bowlerName").value,
            overs: document.getElementById("bowlerO").value,
            runs: parseInt(document.getElementById("bowlerR").value),
            wickets: parseInt(document.getElementById("bowlerW").value),
            eco: document.getElementById("bowlerEco").value
          }
        }
      };

      const res = await fetch('update.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      document.getElementById("result").innerText = await res.text();
    }
  </script>
</body>
</html>